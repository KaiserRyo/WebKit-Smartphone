#!/usr/bin/perl -w
# Copyright (C) Research in Motion Limited 2010. All rights reserved.
#
# Find Fledge and/or print a Windows launcher script to load or debug Fledge.

use strict;
use FindBin;
use lib $FindBin::Bin;
use Getopt::Long;
use olympiadirs;

my $showHelp;
my $printFledgeLauncher;
my $debugger;

my $getOptionsResults = GetOptions(
    'h|help' => \$showHelp,
    'printFledgeLauncher' => \$printFledgeLauncher,
    'debugger' => \$debugger,
);

if (!$getOptionsResults || $showHelp) {
    print STDERR <<__END__;
Usage: @{[ basename($0) ]} [options]
  -h|--help                    show the help message
  --printFledgeLauncher        print the Fledge launcher script
  --debugger                   enable debugger support
__END__
    exit(1);
}

# FIXME: We should add support for Mac Fledge.
dieIfNotWindows();

my @cmd = fledgeLauncherCommand($debugger);

# We need to surround the launcher basename with quotes since it may be a native Windows path.
my $launcherBasename = shift @cmd;
my $launcherCommand = join(' ', "'$launcherBasename'", @cmd);
if (!$printFledgeLauncher) {
    # Print the path to Fledge.
    print "$launcherCommand\n";
    exit(0);
}

my $launcherScript = <<__END__;
#!/bin/sh
# This script was generated by find-fledge.
cd @{[ lynxProductDir() ]}
$launcherCommand
__END__

print "$launcherScript\n";
exit(0);
